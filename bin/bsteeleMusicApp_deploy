#!/bin/tcsh
#set echo; set verbose

set www=/var/www/html/public_html
set app=bsteeleMusicApp
set localDst=$www/$app
set dst=gs://www.bsteele.com/$app
set git=~/github/bsteele_music_flutter


#   verify that the mac is present
ssh bobsmac.local echo yes
set stat=$status
if ( $stat != 0 ) then
	echo bobs mac is missing
	exit $stat
endif



#	compile for release
set git=~/github/bsteele_music_flutter
cd $git
flutter_clean	#	prep
bin/bsteeleMusicApp_war
if ( $status != 0 ) exit -1

#	deploy locally (typically re-deploy)
bin/bsteeleMusicApp_localWarInstall

#	compile for android
bin/bsteeleMusicApp_apk
if ( $status != 0 ) exit -1

#	compile for native macos x86
bin/bsteeleMusicApp_remoteDmg
if ( $status != 0 ) exit -1

#	deploy locally the download page
bin/bsteeleMusicApp_downloadPage
if ( $status != 0 ) exit -1

#	copy local deployment to the web server
bsteele_auth
gsutil -m rsync -d -R -x '.*\.songlyrics\$' $localDst/ $dst 	#	source needs the /
gsutil -m -q setmeta -h "Cache-Control:public, max-age=60" -r $dst
gsutil -m -q acl -r ch -u AllUsers:R $dst

~/github/allSongs.songlyrics/bin/lyrics_update

echo try:  http://bsteele.com/$app
